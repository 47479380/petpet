<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
    <script type="module" crossorigin>
var ht=Object.defineProperty;var lt=(i,t,s)=>t in i?ht(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var g=(i,t,s)=>(lt(i,typeof t!="symbol"?t+"":t,s),s),Q=(i,t,s)=>{if(!t.has(i))throw TypeError("Cannot "+s)};var e=(i,t,s)=>(Q(i,t,"read from private field"),s?s.call(i):t.get(i)),n=(i,t,s)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,s)},a=(i,t,s,r)=>(Q(i,t,"write to private field"),r?r.call(i,s):t.set(i,s),s);var E=(i,t,s)=>(Q(i,t,"access private method"),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const k of l.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&r(k)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}})();const ct={server:[window.location.origin,"http://api.xmmt.fun","http://api.d2n.moe"]};const h=(i="div",t={html:""},s={})=>{const r=document.createElement(i),{html:o,...l}=t;return r.innerHTML=o??"",Object.entries(s).forEach(f=>r.addEventListener(f[0],f[1])),l&&Object.entries(l).forEach(f=>r.setAttribute(f[0],f[1])),r};var U,m,q,et;class tt{constructor(t){n(this,q);n(this,U,void 0);n(this,m,void 0);a(this,U,t)}show(){if(e(this,m))return;const t=h("div",{class:"loading"});t.append(h(),h(),h()),e(this,U).appendChild(t),t.addEventListener("click",E(this,q,et)),a(this,m,t)}hide(){e(this,m)&&(e(this,m).remove(),a(this,m,null))}error(){let t="加载失败";throw e(this,m).innerHTML=`<span>${t}</span>`,new Error(t)}}U=new WeakMap,m=new WeakMap,q=new WeakSet,et=function(t){t.stopPropagation()};const V=new class{constructor(){g(this,"element");g(this,"showing");g(this,"timer");this.element=h("div",{id:"mask"}),document.body.appendChild(this.element),this.showing=!1}set onclick(i){this.timer||this.element.addEventListener("click",i)}show(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.element.style.pointerEvents="auto",this.element.style.display="block",setTimeout(()=>this.element.style.opacity="0.5",10)}hide(){this.element.style.opacity="0",this.element.style.pointerEvents="none",this.timer=setTimeout(()=>this.element.style.display="none",1e3)}togger(){this.showing?this.hide():this.show()}};var d,$,b,D,P,R,G,st;class dt{constructor(t){n(this,G);n(this,d,void 0);n(this,$,void 0);n(this,b,void 0);n(this,D,void 0);n(this,P,void 0);n(this,R,void 0);t&&(this.data=t)}set data(t){a(this,d,h("div",{class:"modal-select"})),a(this,$,t),a(this,b,[]);const s=h("div",{class:"data-list"});a(this,D,s);for(const o of t.petData){const l=o.key,k=`${t.url}/preview/${l}`,f=h("div",{html:`
                    <img src="${k}.gif" alt="${l}" loading="lazy" onerror="this.src = '${k}.png'">
                    <h3>${l}${o.alias.map(_=>`<span>${_}</span>`).join("")}</h3>`},{click:_=>{e(this,R).call(this,o),this.hide()}});f.info=o,e(this,b).push(f)}s.append(...e(this,b));const r=h("input",{placeholder:"🔍 type to search"},{change:o=>this.search(o.target.value.trim())});e(this,d).append(r,s),V.onclick=()=>{this.hide(),e(this,R).call(this,null)},e(this,P)&&e(this,P).call(this),e(this,d).classList.add("hide"),document.body.appendChild(e(this,d))}hide(){V.hide(),e(this,d).classList.add("hide")}async show(){return e(this,$)||await E(this,G,st).call(this),V.show(),e(this,d)&&e(this,d).classList.remove("hide"),new Promise(t=>a(this,R,t))}search(t){e(this,D).innerHTML="",e(this,D).append(...e(this,b).filter(s=>{const{key:r,alias:o}=s.info;return r.includes(t)||o.find(l=>l.includes(t))}))}}d=new WeakMap,$=new WeakMap,b=new WeakMap,D=new WeakMap,P=new WeakMap,R=new WeakMap,G=new WeakSet,st=async function(){if(!e(this,$))return new Promise(t=>a(this,P,t))};var N,y,I,S;class pt{constructor(t){n(this,N,void 0);n(this,y,void 0);n(this,I,void 0);g(this,"loading");n(this,S,void 0);a(this,N,t),a(this,y,h("div",{id:"template-chooser",html:"未选择"})),h("div"),e(this,y).addEventListener("click",async()=>{const s=this.showModal();e(this,S)&&e(this,S).call(this,s)}),a(this,I,new dt(t)),this.loading=new tt(e(this,y)),t||this.loading.show()}set data(t){this.loading.hide(),a(this,N,t),e(this,I).data=t}get dom(){const t=h();return t.append(h("h3",{html:"Step 1: 选择模板"}),e(this,y)),t}async showModal(){const t=await e(this,I).show();return t&&(e(this,y).innerHTML=t.key),t}set onchange(t){a(this,S,t)}}N=new WeakMap,y=new WeakMap,I=new WeakMap,S=new WeakMap;const X=i=>{i.stopPropagation(),i.preventDefault()};var c,x,j;class mt{constructor(t){g(this,"type");n(this,c,void 0);n(this,x,void 0);n(this,j,void 0);this.type=t,a(this,c,h("label",{type:t})),e(this,c).addEventListener("dragenter",X,!1),e(this,c).addEventListener("dragover",X,!1),e(this,c).addEventListener("drop",r=>{X(r),this.chooseFiles(r.dataTransfer.files)},!1);const s=h("input",{type:"file",accept:"image/*"},{change:r=>this.chooseFiles(r.target.files)});e(this,c).appendChild(s)}get dom(){return e(this,c)}set onchange(t){a(this,j,t)}get file(){return e(this,x)}chooseFiles(t){let s=t.item(0);if(s){if(!s.type.startsWith("image"))throw new Error("仅支持图片格式");e(this,c).style.backgroundImage=`url(${URL.createObjectURL(s)})`,e(this,c).style.backgroundSize="cover",a(this,x,s),e(this,j)&&e(this,j).call(this,this)}}}c=new WeakMap,x=new WeakMap,j=new WeakMap;const Z=["FROM","TO","BOT","GROUP"],ut=new Map(Z.map(i=>[i,i.toLowerCase()+"Avatar"]));var w,T,C;class it{constructor(){n(this,w,void 0);n(this,T,void 0);n(this,C,void 0);a(this,w,h("div",{id:"avatar-uploader"})),a(this,T,new Map(Z.map(t=>[t,new mt(t)]))),e(this,T).values(),this.types=null}set types(t){if(!t||t.length===0){e(this,w).innerHTML="无头像参数";return}e(this,w).innerHTML="",a(this,C,t.map(s=>e(this,T).get(s))),e(this,w).append(...e(this,C).map(s=>s.dom))}get dom(){const t=h();return t.append(h("h3",{html:"Step 2: 上传图片"}),e(this,w)),t}get ready(){return e(this,C).some(t=>t.file)}set onchange(t){const s=()=>this.ready&&t(this);[...e(this,T).values()].forEach(r=>r.onchange=s)}get data(){return e(this,C).map(t=>({name:ut.get(t.type),file:t.file}))}}w=new WeakMap,T=new WeakMap,C=new WeakMap,g(it,"types",Z);var F,M,v,L,K,nt,W,at;class ft{constructor(){n(this,K);n(this,W);n(this,F,void 0);n(this,M,void 0);n(this,v,void 0);n(this,L,void 0);a(this,F,h()),a(this,M,h("div",{id:"result-area"})),e(this,F).append(h("h3",{html:"Result: 生成结果"}),e(this,M)),a(this,v,new Image),E(this,K,nt).call(this),e(this,M).appendChild(e(this,v)),a(this,L,new tt(e(this,M))),e(this,L).show()}set promise(t){(async()=>{e(this,L).show();try{const s=await t;e(this,v).src=URL.createObjectURL(await s.blob()),E(this,W,at).call(this),e(this,L).hide()}catch(s){throw e(this,L).error(),new Error(s)}})()}get dom(){return e(this,F)}}F=new WeakMap,M=new WeakMap,v=new WeakMap,L=new WeakMap,K=new WeakSet,nt=function(){e(this,v).classList.add("hide")},W=new WeakSet,at=function(){e(this,v).classList.remove("hide")};var O,H,z,u,p,A,Y,rt,J,ot,B;class gt{constructor(t){n(this,Y);n(this,J);n(this,O,void 0);n(this,H,void 0);n(this,z,void 0);n(this,u,void 0);n(this,p,void 0);n(this,A,void 0);n(this,B,async t=>{t&&(a(this,z,t),e(this,p)||(a(this,p,new it),e(this,p).onchange=this.generate,e(this,O).appendChild(e(this,p).dom)),e(this,p).types=[...new Set(t.types)],this.generate())});g(this,"generate",async()=>{if(!e(this,p).ready)return;e(this,A)||(a(this,A,new ft),e(this,O).appendChild(e(this,A).dom));const t=new FormData;t.append("key",e(this,z).key);for(const s of e(this,p).data)t.append(s.name,s.file,s.name);e(this,A).promise=fetch(e(this,H)+"/petpet",{body:t,method:"post"})});E(this,Y,rt).call(this,t)}}O=new WeakMap,H=new WeakMap,z=new WeakMap,u=new WeakMap,p=new WeakMap,A=new WeakMap,Y=new WeakSet,rt=async function(t){a(this,O,document.getElementById(t)),a(this,u,new pt),e(this,O).appendChild(e(this,u).dom),await E(this,J,ot).call(this);const s=await e(this,u).showModal();e(this,u).onchange=async r=>e(this,B).call(this,await r),e(this,B).call(this,s)},J=new WeakSet,ot=async function(){for(const t of ct.server){const s=await fetch(t+"/petpet").then(r=>r.json());if(s){s.url=t,a(this,H,t),e(this,u).data=s;break}}return e(this,H)||e(this,u).loading.error(),!0},B=new WeakMap;new gt("app");

</script>
    <style>
#template-chooser{cursor:pointer;position:relative;width:min(50vw,24em);padding:2em 4em;border:var(--text) 2px dashed;border-radius:16px}.modal-select{width:calc(min(50vw,24em) + 8em);height:95%;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--sub-bg);opacity:1;overflow:hidden;box-shadow:#333 5px 5px 5px;border:5px solid var(--sub-bg);border-radius:12px;z-index:100}.modal-select>.data-list{height:calc(100% - 40px);display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden}.modal-select>.data-list div{padding:.6em;color:var(--text);font-size:.8rem;margin-top:1.8em;border-radius:8px;cursor:pointer;transform:scale(1);transition:all .3s}.modal-select>.data-list div:hover{background:hsla(0,0%,80%,.14);transform:scale(1.3)}.modal-select>.data-list>div{display:flex;flex-direction:column;align-items:center}.modal-select>.data-list>div>h3{margin:.2em 0}.modal-select>.data-list>div>h3>span{margin-left:.4em;font-size:.6em;transition:margin-left .4s}.modal-select>.data-list>div:hover>h3>span{margin-left:.8em}.modal-select>.data-list>div>img{max-width:20em;max-height:18em;object-fit:contain;background:linear-gradient(45deg,var(--text) 0,var(--text) 25%,transparent 25%,transparent 50%,var(--text) 50%,var(--text) 75%,transparent 75%,transparent);background-size:20px 20px;border:4px var(--text) solid;border-radius:8px}.modal-select>.data-list p{text-align:center;font-weight:600}.modal-select>input{font-size:1.4em;font-weight:bolder;height:1.2em;width:100%;border:none;border-bottom:var(--text) dashed 2px;outline:none;margin:0}@media (max-width: 650px){.modal-select>.data-list div{min-width:max-content;padding:.8em .2em;margin:.6em .2em}}.loading{display:inline-table;position:absolute;border-radius:inherit;width:100%;height:100%;left:0;top:0;margin:0;opacity:.9;background-color:var(--sub-bg)}.loading span{display:table-cell;text-align:center;vertical-align:middle;font-size:large;font-weight:700;color:var(--hl-text)}.loading div{--size: 64px;--width: 8px;box-sizing:border-box;display:block;position:absolute;top:calc(50% - var(--size) / 2);left:calc(50% - var(--size) / 2);transform:translate(-50%,-50%);width:var(--size);height:var(--size);border:var(--width) solid;border-radius:50%;animation:lds-ring 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:var(--hl-text) transparent transparent transparent}.loading div:nth-child(1){animation-delay:-.45s}.loading div:nth-child(2){animation-delay:-.3s}.loading div:nth-child(3){animation-delay:-.15s}@keyframes lds-ring{0%{transform:rotate(0)}to{transform:rotate(360deg)}}#mask{width:100vw;height:100vh;position:fixed;background:#333;display:none;top:0;left:0;opacity:0;transition:opacity 1s;z-index:50}#avatar-uploader{position:relative;width:calc(min(50vw,24em) + 6em);padding:1em;border:var(--text) 2px dashed;border-radius:16px;display:flex;flex-wrap:wrap;justify-content:space-around}#avatar-uploader>label{cursor:pointer;margin:.6em;width:8em;height:8em;background-size:20px 20px;background-clip:border-box;background-image:linear-gradient(45deg,var(--text) 0,var(--text) 25%,transparent 25%,transparent 50%,var(--text) 50%,var(--text) 75%,transparent 75%,transparent);background-position:center;border:var(--text) 2px solid;border-radius:8px;display:flex;align-items:center;justify-content:center}#avatar-uploader>label:before{transition:transform .25s ease-in-out;transform:scale(1);content:attr(type);color:var(--text);padding:.2em .6em;background:var(--sub-bg);border-radius:8px;border:var(--text) 2px solid}#avatar-uploader>label:hover:before{transform:scale(0)}#avatar-uploader>label>input{display:none}#result-area{position:relative;max-width:calc(min(50vw,24em) + 8em);min-height:8em;border-radius:16px}#result-area>img{width:100%;border-radius:inherit}#app{display:flex;flex-direction:column;align-items:center;text-align:center}#app>div{padding:0 0 .8em;border-top:var(--sub-bg) 2px dashed;position:relative}#app h3{color:var(--text)}:root{--bg: #faeee7;--text: #594a4e;--sub-bg: #fffffe;--sub-text: #33272a;--card-bg: #ffc6c7;--hl-text: #ff8ba7;font-family:system-ui,\2014 apple-system,Segoe UI,Rototo,Emoji,Helvetica,Arial,sans-serif}@font-face{font-family:Emoji;src:local("Apple Color Emojiji"),local("Segoe UI Emoji"),local("Segoe UI Symbol"),local("Noto Color Emoji");unicode-range:U+1F000-1F644,U+203C-3299}body,html{position:relative;margin:0;color:var(--text);background:var(--bg)}h1,h2{padding-left:10px;padding-right:10px}input{background:var(--sub-bg);padding:5px;border:1px var(--sub-text) solid;border-radius:4px;color:var(--text)}.button-group{padding:0 .5em;display:flex;flex-direction:row;justify-content:space-between}.button-group>div,.button-group-item{height:2em;padding:0 1em;font-weight:700;text-align:center;border-radius:4px;margin:.3em;cursor:pointer;line-height:2em;width:100%;background-color:var(--hl-text);white-space:nowrap;transition:all .6s}.button-group>div:focus,.button-group-item:focus{background:hsla(0,0%,80%,.14)}.button-group>div:hover,.button-group-item:hover{color:var(--text-hover);box-shadow:#00000012 0 1px 2px,#00000012 0 2px 4px,#00000012 0 4px 8px,#00000012 0 8px 16px,#00000012 0 16px 32px,#00000012 0 32px 64px}.hide{display:none}.bottom{padding-bottom:1em;margin:2em 0}.links{display:flex;text-align:center;flex-direction:column}.links>a{color:var(--hl-text);transition:font-size .6s;letter-spacing:.06ch}.links>a:hover{font-size:large;letter-spacing:.2ch}:root *::-webkit-scrollbar-track{box-shadow:inset 0 0 6px #0000004d;border-radius:10px;background-color:var(--bg)}:root *::-webkit-scrollbar{width:12px;background-color:var(--bg)}:root *::-webkit-scrollbar-thumb{border-radius:10px;box-shadow:inset 0 0 6px #0000004d;background-color:var(--hl-text)}@media (prefers-color-scheme: dark){:root{--bg: #242629;--bg-focus: #3d4046;--text: #fffffe;--text-hover: #fffffed2;--sub-bg: #16161a;--sub-text: #fffffe;--card-bg: #7f5af0;--hl-text: #2cb67d;--hl-text-hover: #2cb67dd2;--placeholder: #696f7a}}@media screen and (max-width: 650px){summary{padding-left:.2em}.bottom{padding-bottom:4em}}

</style>
  </head>
  <body>
    <h1>Petpet</h1>
    <div id="app"></div>
    
  </body>
</html>
